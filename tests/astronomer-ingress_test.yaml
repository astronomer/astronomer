---
suite: Test ingress
templates:
  - charts/astronomer/templates/ingress.yaml
tests:
  - it: Should be empty when baseDomain is not set
    asserts:
      - hasDocuments:
          count: 0

  - it: Should be ingress when baseDomain is set
    set:
      global.baseDomain: example.com
    asserts:
      - isKind:
          of: Ingress

  - it: "Should use ingress networking.k8s.io/v1beta1 with k8s < 1.19"
    set:
      global.baseDomain: example.com
    capabilities:
      majorVersion: 1
      minorVersion: 18
    asserts:
      - equal:
          path: apiVersion
          value: networking.k8s.io/v1beta1

  - it: "Should use ingress networking.k8s.io/v1 with k8s >= 1.19"
    set:
      global.baseDomain: example.com
    capabilities:
      majorVersion: 1
      minorVersion: 19
    asserts:
      - equal:
          path: apiVersion
          value: networking.k8s.io/v1
